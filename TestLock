-- anti team lock
getgenv().AutoHighArm = false;
getgenv().lock = false;
getgenv().AutoInfHealth = false;
getgenv().autoRst = false;
getgenv().stomp = false;
getgenv().tp = false;
getgenv().silent = false;
getgenv().FLING = false;
getgenv().VIEW = false;
getgenv().customUI = false;
function customLayout()
    local me = game.Players.LocalPlayer
    me.PlayerGui.gui.Bar.Armor.BackgroundColor3 = Color3.fromRGB(127,77,10)
    me.PlayerGui.gui.Bar.Armor.ImageLabel.BackgroundColor3 = Color3.fromRGB(217,122,20)
    me.PlayerGui.gui.Bar.Health.BackgroundColor3 = Color3.fromRGB(94,31,31)
    me.PlayerGui.gui.Bar.Health.ImageLabel.BackgroundColor3 = Color3.fromRGB(255,0,0)
end
local camera = game.Workspace.Camera
local findarmour = function()
    for _, v in pairs(game.Workspace:GetDescendants()) do
        if v.Name == "[High-Medium Armor]" then
            Highmed = v
        end
    end
    return Highmed
end
local armour = findarmour()
local user
local VICTIM
local silentVic
local TS = game.TweenService
local tweeninfo = TweenInfo.new(0.5)
local camLerp = 0.462
local RS = game:GetService("RunService")
local prediction = 0.32115
local teammates = {}

-- CHATSPY
loadstring(game:HttpGet("https://pastebin.com/raw/nzXicwc1", true))()
RS.RenderStepped:Connect(function()
    if customUI then
        customLayout()
    end
    local rlBtn = game:GetService("Players").LocalPlayer.PlayerGui.gui["mobile ppl"].rl
    rlBtn.Size = UDim2.new(0, 60, 0, 60)
    local plrs = game.Players
    local lplr = plrs.LocalPlayer
    for _, v in pairs(plrs:GetPlayers()) do
        if v:GetAttribute("group") == lplr:GetAttribute("group") and v:GetAttribute("group") ~= 0 then
            table.insert(teammates, v.Name)
        end
    end
end)

local function getFullUser(input)
    user = nil
    local MATCHES = {}
    local PLAYERS = game.Workspace:GetChildren()
    local LEN = #input
    if input == "" or input == " " then user = nil return end
    for _, PLAYER in ipairs(PLAYERS) do
        local PLR = PLAYER.Name:lower()
        local INP = input:lower()
        if string.sub(PLR,1,#INP) == INP and PLAYER:FindFirstChild("Humanoid") then
            table.insert(MATCHES, PLAYER.Name)
        end
    end
    if #MATCHES > 0 then
        if MATCHES[1] ~= game.Players.LocalPlayer.Name then
            user = MATCHES[1]
        end
        return user
    else
        user = nil
        return user
    end
end

local function getClosest()
    local LocalName = game.Players.LocalPlayer.Name
    local dis = math.huge
    local plr = nil
    local plrs = {}
    for _, v in pairs(game.Players:GetChildren()) do
        if v ~= game.Players.LocalPlayer and not game.Workspace[v.Name]:GetAttribute("Knocked") and not table.find(teammates, v.Name) then
            table.insert(plrs, v.Name)
        end
    end
    for _, v in ipairs(plrs) do
        local disDiff = (game.Workspace[LocalName].HumanoidRootPart.Position - game.Workspace[v].HumanoidRootPart.Position).magnitude
        if disDiff < dis then
            dis = disDiff
            plr = game.Workspace[v]
        end
    end
    return plr
end

local function silentLock()
    spawn(function()
        silentVic = getClosest()
        while wait() do
            if silent then
                local TargetVelocity = Vector3.new(silentVic.UpperTorso.Velocity.X * prediction, 0, silentVic.UpperTorso.Velocity.Z * prediction)
                if silentVic and not silentVic:GetAttribute("Knocked") and game.Players[silentVic.Name] then
                    if silentVic.UpperTorso then
                        camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, silentVic.UpperTorso.Position + TargetVelocity), camLerp)
                    end
                end
            end
            if silentVic == nil then break end
        end
    end)
end

local function InfHealth()
    spawn(function()
        while wait() do
            local PlrName = game.Players.LocalPlayer.Name
            if AutoInfHealth then
                if game.Workspace:FindFirstChild(PlrName).Humanoid then
                    game.Workspace:FindFirstChild(PlrName).Head:BreakJoints()
                    game.Workspace:FindFirstChild(PlrName).Head.Position = Vector3.new(0,9999999,0)
                end
            end
        end
    end)
end 

local function startLock(loser)
    spawn(function()
        while wait() do
            if lock then
                VICTIM = loser
                target = game.Workspace[VICTIM]
                local TargetVelocity = Vector3.new(target.UpperTorso.Velocity.X * prediction, 0, target.UpperTorso.Velocity.Z * prediction)
                if target and not target:GetAttribute("Knocked") and game.Players[target.Name] then
              				    if target.UpperTorso then
                  				    camera.CFrame = camera.CFrame:Lerp(CFrame.new(camera.CFrame.Position, target.UpperTorso.Position + TargetVelocity), camLerp)
              				    end
                end
            end
            if not lock then break end 
        end
    end)
end

game.Workspace.ChildAdded:Connect(function(new)
    if new.Name == user then
        startLock(user)
    end
end)

local function autoTp(username)
    spawn(function()
        while wait() do
            if tp then
                local LPN = game.Players.LocalPlayer.Name
                local LP = game.Workspace[LPN]
                local VP = game.Workspace[username]
                if LP.HumanoidRootPart and VP.HumanoidRootPart then
                    LP.HumanoidRootPart.CFrame = CFrame.new(VP.UpperTorso.Position)
                end
            end
        end
    end)
end

local function normalTp(username)
    local LPN = game.Players.LocalPlayer.Name
    local LP = game.Workspace[LPN]
    local VP = game.Workspace[username]
    if LP.HumanoidRootPart and VP.HumanoidRootPart then
        LP.HumanoidRootPart.CFrame = CFrame.new(VP.UpperTorso.Position)
    end
end

local function LockNotif()
    if user then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Lock Notification",
            Text = [[
            Display: ]] .. tostring(game.Workspace[user].Humanoid.DisplayName) .. [[
            
            Main user: ]] .. user,
            Icon = "",
            Duration = 0.7
        })
    end
end

local function UnLockNotif()
    game.StarterGui:SetCore("SendNotification", {
        Title = "Lock Notification",
        Text = "Unlocked...",
        Icon = "",
        Duration = 0.7
    })
end

local function autoBuyArmour()
    local me = game.Players.LocalPlayer.Name
    spawn(function()
        while wait() do
            if AutoHighArm and game.Workspace:FindFirstChild(me):GetAttribute("Armor") < 120 and armour then
                fireclickdetector(armour.ClickDetector)
                wait()
            end
        end
    end)
end

local function autoStomp()
    spawn(function()
        while wait() do
            if stomp then
                game:GetService("ReplicatedStorage"):WaitForChild("MAINEVENT"):FireServer("STOMP")
            end
        end
    end)
end

if game.CoreGui:FindFirstChild("DrRay") then
    game.CoreGui:FindFirstChild("DrRay"):Destroy()
    if game.CoreGui:FindFirstChild("ButtonHandler") then
        game.CoreGui:FindFirstChild("ButtonHandler"):Destroy()
    end
end

local lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()
local window = lib:Load("Made By Tariq", "Default")
local tab = lib.newTab("Main", "")
local tab2 = lib.newTab("Target", "")
local tab3 = lib.newTab("Player", "")

local colours = {
    "red",
    "lightred",
    "orange",
    "yellow",
    "blue",
    "darkblue",
    "teal",
    "pink",
    "purple",
    "regular"
}
local colour = nil

tab.newDropdown("Pick A Colour", "", colours, function(picked)
    colour = picked
    return colour
end)
tab.newButton("Apply Sky Colour", "", function()
    game.Players.LocalPlayer:SetAttribute("skycolor", colour)
end)
tab.newToggle("Auto Buy High-Medium Armour", "", false, function(bool)
    AutoHighArm = bool
    autoBuyArmour()
end)
tab.newToggle("Auto Stomp", "", false, function(bool)
    stomp = bool
    autoStomp()
end)
tab.newToggle("Custom Layout", "", false, function(bool)
    customUI = bool
end)

tab2.newInput("Username", "Username to lock on.", function(inp)
    getFullUser(inp)
end)
tab2.newToggle("Lock On User", "Starts the lock.", false, function(bool)
    if not bool then
        UnLockNotif()
        VICTIM = nil
    end
    if bool then
        LockNotif()
    end
    lock = bool
    startLock(user)
end)
tab2.newToggle("View Player", "Views selected player.", false, function(bool)
    VIEW = bool
    local NAME = game.Players.LocalPlayer.Name
    local ME = game.Workspace[NAME]
    local normalCam = ME.Humanoid
    if user and game.Workspace[user] and VIEW then
        if ME then
            camera.CameraSubject = game.Workspace[user].Humanoid
        else
            camera.CameraSubject = normalCam
        end
    else
        camera.CameraSubject = normalCam
    end
    if not VIEW then
        camera.CameraSubject = normalCam
    end
end)
tab2.newButton("Teleport To User", "", function()
    normalTp(user)
end)
tab2.newToggle("Fling User", "Flings selected user.", false, function(bool)
    FLING = bool
    local NAME = game.Players.LocalPlayer.Name
    local ME = game.Workspace[NAME]
    if FLING then
        local LOOP
        local xchange
        local zchange
        local oldPos = ME.HumanoidRootPart.Position
        local flingLoop = function()
            local succ, err = pcall(function()
                local enemy = game.Workspace[user]
                if enemy and ME and not ME:GetAttribute("Knocked") and not enemy:GetAttribute("Knocked") then
                    local flingPoint = enemy.UpperTorso
                    local dis = 3.85
                    local inc = 4.5
                    if enemy.Humanoid.MoveDirection.X < 0 then
                        xchange = -inc
                    elseif enemy.Humanoid.MoveDirecton.X > 0 then
                        xchange = inc
                    elseif enemy.Humanoid.MoveDirecton.X == 0 then
                        xchange = 0
                    end
                    if enemy.Humanoid.MoveDirection.Z < 0 then
                        zchange = -inc
                    elseif enemy.Humanoid.MoveDirecton.Z > 0 then
                        zchange = inc
                    elseif enemy.Humanoid.MoveDirecton.Z == 0 then
                        zchange = 0
                    end
                    if ME then
                        local daX = flingPoint.Position.X + math.random(-dis,dis) + xchange
                        local daZ = flingPoint.Position.Z + math.random(-dis,dis) + zchange
                        ME.Humanoid.PlatformStand = true
                        ME.HumanoidRootPart.CFrame = CFrame.new(daX, flingPoint.Position.Y,  daZ) * CFrame.Angles(math.rad(ME.HumanoidRootPart.Orientation.X + 350), math.rad(ME.HumanoidRootPart.Orientation.Y + 200), math.rad(ME.HumanoidRootPart.Orientation.Z + 240))
                        ME.HumanoidRootPart.Velocity = Vector3.new(500,500,500)
                    end
                    if not enemy.Humanoid.MoveDirection then
                        ME.Humanoid.PlatformStand = true
                        ME.HumanoidRootPart.CFrame = CFrame.new(flingPoint)
                        repeat ME.HumanoidRootPart.CFrame = CFrame.new(flingPoint) wait(0.5) until not FLING
                    end
                end
            end)
            if err then
                print("Smth went wrong with da fling: "..err)
            end
        end
        local StartFling = function()
            oldPos = ME.HumanoidRootPart.Position
            LOOP = RS.RenderStepped:Connect(flingLoop)
        end
        local StopFling = function()
            LOOP:Disconnect()
            local vZero = Vector3.new(0,0,0)
            ME.HumanoidRootPart.Velocity = vZero
            ME.HumanoidRootPart.RotVelocity = vZero
            ME.HumanoidRootPart.CFrame = CFrame.new(oldPos)
        end
        StartFling()
        repeat wait() until not FLING
        StopFling()
        ME.Humanoid.PlatformStand = false
    end
end)

tab3.newInput("Camera Lerp Amount", "", function(amt)
    if type(amt) == "number" then
        camLerp = amt
    else
        camLerp = 0.462
    end
end)

tab3.newInput("Prediction Amount", "", function(amt)
    if type(amt) ~= "string" then
        prediction = amt
    else
        prediction = 0.32115
    end
end)
tab3.newButton("Lock Button", "Creates a new lock button.", function()
    local btnGui = Instance.new("ScreenGui")
    local btn = Instance.new("TextButton")
    btnGui.Name = "ButtonHandler"
    btnGui.Parent = game.CoreGui
    btnGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    btn.Name = "LButton"
    btn.Parent = btnGui
    btn.BackgroundColor3 = Color3.fromRGB(3,40,53)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, 737, 0, 35)
    btn.Size = UDim2.new(0, 100, 0, 50)
    btn.Font = Enum.Font.GothamBlack
    btn.Text = "Lock"
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextSize = 18
    
    local corner = Instance.new("UICorner")
    corner.Parent = btn
    corner.CornerRadius = UDim.new(0,10)
    corner.Name = "CORNER"
    
    btn.MouseButton1Click:Connect(function()
        if lock then
            lock = false
            btn.Text = "Lock"
        elseif not lock then
            lock = true
            btn.Text = "Unlock"
        end
        if not lock then
            UnLockNotif()
            VICTIM = nil
        end
        if lock then
            LockNotif()
        end
        startLock(user)
    end)
end)
tab3.newButton("Silent Lock", "Locks on the closest person.", function()
    local silentBtn = Instance.new("TextButton")
    silentBtn.Name = "SilentButton"
    silentBtn.Parent = game.CoreGui:FindFirstChild("ButtonHandler")
    silentBtn.BackgroundColor3 = Color3.fromRGB(3,40,53)
    silentBtn.BorderSizePixel = 0
    silentBtn.BackgroundTransparency = 0.1
    silentBtn.Position = UDim2.new(0, 630, 0, -15)
    silentBtn.Size = UDim2.new(0, 100, 0, 50)
    silentBtn.Font = Enum.Font.GothamBlack
    silentBtn.Text = "Silent Lock"
    silentBtn.TextColor3 = Color3.new(1,1,1)
    silentBtn.TextSize = 16
    silentBtn.TextTransparency = 0.132
    
    local corner = Instance.new("UICorner")
    corner.Parent = silentBtn
    corner.CornerRadius = UDim.new(0,10)
    corner.Name = "CORNER"
    
    silentBtn.MouseButton1Click:Connect(function()
        if not silent then
            silent = true
            silentBtn.Text = "Unlock Silent"
            game.StarterGui:SetCore("SendNotification", {
                Title = "Lock Notification",
                Text = [[
                Display: ]] .. tostring(game.Workspace[getClosest().Name].Humanoid.DisplayName) .. [[
                
                Main user: ]] .. getClosest().Name,
                Icon = "",
                Duration = 0.7
            })
        elseif silent then
            silent = false
            silentBtn.Text = "Silent Lock"
        end
        if not silent then
            UnLockNotif()
            silentVic = nil
        end
        silentLock()
    end)
end)
tab3.newButton("Destroy Lock Buttons", "Destroys all buttons created by this script.", function()
    if game.CoreGui:FindFirstChild("ButtonHandler") then
        game.CoreGui:FindFirstChild("ButtonHandler"):Destroy()
    end
end)
tab3.newButton("Kick", "", function()
    local LP = game.Players.LocalPlayer
    if LP then
        LP:Kick("Did you get the last stomp?")
    end
end)
