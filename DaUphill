getgenv().AutoHighArm = false;
getgenv().lock = false;
getgenv().AutoInfHealth = false;
getgenv().autoRst = false;
getgenv().stomp = false;
getgenv().tp = false;
getgenv().silent = false
local camera = game.Workspace.Camera
local user = nil
local userPart = nil
local TS = game.TweenService
local tweeninfo = TweenInfo.new(0.5)
local RS = game:GetService("RunService")
local VICTIM = nil
local silentVic = nil
local prediction = 0.311505

-- CHATSPY
loadstring(game:HttpGet("https://pastebin.com/raw/nzXicwc1", true))()

local function getFullUser(input)
    user = nil
    local MATCHES = {}
    local PLAYERS = game.Workspace:GetChildren()
    local LEN = #input
    if input == "" or input == " " then user = nil return end
    for _, PLAYER in ipairs(PLAYERS) do
        local PLR = PLAYER.Name:lower()
        local INP = input:lower()
        if string.sub(PLR,1,#INP) == INP and PLAYER:FindFirstChild("Humanoid") then
            table.insert(MATCHES, PLAYER.Name)
        end
    end
    if #MATCHES > 0 then
        user = MATCHES[1]
        return user
    else
       user = nil
        return user
    end
end

local function getClosest()
    local LocalName = game.Players.LocalPlayer.Name
    local dis = math.huge
    local plr = nil
    local plrs = {}
    for _, v in pairs(game.Players:GetChildren()) do
        if v ~= game.Players.LocalPlayer and not game.Workspace[v.Name]:GetAttribute("Knocked") then
            table.insert(plrs, v.Name)
        end
    end
    for _, v in ipairs(plrs) do
        local disDiff = (game.Workspace[LocalName].HumanoidRootPart.Position - game.Workspace[v].HumanoidRootPart.Position).magnitude
        if disDiff < dis then
            dis = disDiff
            plr = game.Workspace[v]
        end
    end
    return plr
end

local function silentLock()
    spawn(function()
        silentVic = getClosest()
        while wait() do
            if silent then
                local TargetVelocity = Vector3.new(silentVic.UpperTorso.Velocity.X * prediction, 0, silentVic.UpperTorso.Velocity.Z * prediction)
                if silentVic and not silentVic:GetAttribute("Knocked") and game.Players[silentVic.Name] then
                    if silentVic.UpperTorso then
                        camera.CFrame = CFrame.new(camera.CFrame.Position, silentVic.UpperTorso.Position + TargetVelocity)
                    end
                end
            end
            if silentVic == nil then break end
        end
    end)
end

local function InfHealth()
    spawn(function()
        while wait() do
            local PlrName = game.Players.LocalPlayer.Name
            if AutoInfHealth then
                if game.Workspace:FindFirstChild(PlrName).Humanoid then
                    game.Workspace:FindFirstChild(PlrName).Head:BreakJoints()
                    game.Workspace:FindFirstChild(PlrName).Head.Position = Vector3.new(0,9999999,0)
                end
            end
        end
    end)
end 

local function startLock(loser)
    spawn(function()
        while wait() do
            if lock then
                VICTIM = loser
                target = game.Workspace[VICTIM]
                local TargetVelocity = Vector3.new(target.UpperTorso.Velocity.X * prediction, 0, target.UpperTorso.Velocity.Z * prediction)
                if target and not target:GetAttribute("Knocked") and game.Players[target.Name] then
              				    if target.UpperTorso then
                  				    camera.CFrame = CFrame.new(camera.CFrame.Position, target.UpperTorso.Position + TargetVelocity)
              				    end
                end
            end
            if VICTIM == nil then break end 
        end
    end)
end

game.Workspace.ChildAdded:Connect(function(new)
    if new.Name == user then
        startLock(user)
    end
end)

local function autoTp(username)
    spawn(function()
        while wait() do
            if tp then
                local LPN = game.Players.LocalPlayer.Name
                local LP = game.Workspace[LPN]
                local VP = game.Workspace[username]
                if LP.HumanoidRootPart and VP.HumanoidRootPart then
                    LP.HumanoidRootPart.CFrame = CFrame.new(VP.UpperTorso.Position)
                end
            end
        end
    end)
end

local function normalTp(username)
    local LPN = game.Players.LocalPlayer.Name
    local LP = game.Workspace[LPN]
    local VP = game.Workspace[username]
    if LP.HumanoidRootPart and VP.HumanoidRootPart then
        LP.HumanoidRootPart.CFrame = CFrame.new(VP.UpperTorso.Position)
    end
end

local function autoReset()
    spawn(function()
        while wait() do
            if autoRst then
                local LP = game.Players.LocalPlayer.Name
                local WLP = game.Workspace[LP]
                local HRT = WLP.HumanoidRootPart
                if WLP.Humanoid.Health <= 5 then
                    local oldPOS = HRT.CFrame.Position
                    HRT.Size = Vector3.new(1,2,0.5)
                    HRT.CFrame = CFrame.new(99999, 99999, 99999)
                    WLP.Humanoid.Health = 0
                    wait(4.5)
                    HRT.CFrame = CFrame.new(oldPOS)
                end
            end
        end
    end)
end

local function LockNotif()
    if user then
        game.StarterGui:SetCore("SendNotification", {
            Title = "Lock Notification",
            Text = "Locked On: "..tostring(user),
            Icon = "",
            Duration = 0.7
        })
    end
end

local function UnLockNotif()
    game.StarterGui:SetCore("SendNotification", {
        Title = "Lock Notification",
        Text = "Unlocked...",
        Icon = "",
        Duration = 0.7
    })
end

local function autoBuyArmour()
    spawn(function()
        while wait() do
            if AutoHighArm then
                local me = game.Players.LocalPlayer.Name
                fireclickdetector(game.workspace.MAP.Ignored.BuyPads["[High-Medium Armor]"].ClickDetector)
                wait()
                game.Workspace[me]:SetAttribute("PurchaseCooldown", false)
            end
        end
    end)
end

local function autoStomp()
    spawn(function()
        while wait() do
            if stomp then
                game:GetService("ReplicatedStorage"):WaitForChild("MAINEVENT"):FireServer("STOMP")
            end
        end
    end)
end

if game.CoreGui:FindFirstChild("DrRay") then
    game.CoreGui:FindFirstChild("DrRay"):Destroy()
    if game.CoreGui:FindFirstChild("ButtonHandler") then
        game.CoreGui:FindFirstChild("ButtonHandler"):Destroy()
    end
end

local lib = loadstring(game:HttpGet("https://raw.githubusercontent.com/AZYsGithub/DrRay-UI-Library/main/DrRay.lua"))()
local window = lib:Load("Made By Tariq", "Default")
local tab = lib.newTab("Main", "")
local tab2 = lib.newTab("Player", "")
local tab3 = lib.newTab("Sky Colours", "")

tab.newInput("Username", "Username to lock on.", function(inp)
    getFullUser(inp)
end)
tab.newToggle("Lock On User", "Starts the lock.", false, function(bool)
    if not bool then
        UnLockNotif()
        VICTIM = nil
    end
    if bool then
        LockNotif()
    end
    lock = bool
    startLock(user)
end)
tab.newToggle("Auto Buy High-Medium Armour", "", false, function(bool)
    AutoHighArm = bool
    autoBuyArmour()
end)
tab.newToggle("Auto Stomp", "", false, function(bool)
    stomp = bool
    autoStomp()
end)
tab.newToggle("Auto Teleport To User", "", false, function(bool)
    tp = bool
    autoTp(user)
end)
tab.newToggle("Headless", "", false, function(bool)
    AutoInfHealth = bool
    InfHealth()
end)
--[[
tab.newToggle("Auto Reset", "Auto resets when health is below/equal to 5.", false, function(bool)
    autoRst = bool
    autoReset()
end)
]]
tab.newButton("Teleport To User", "", function()
    normalTp(user)
end)
tab2.newInput("Prediction Amount", "", function(amt)
    if type(amt) ~= "string" then
        prediction = amt
    else
        prediction = 0.311505
    end
end)
tab2.newButton("Lock Button", "Creates a new lock button.", function()
    local btnGui = Instance.new("ScreenGui")
    local btn = Instance.new("TextButton")
    btnGui.Name = "ButtonHandler"
    btnGui.Parent = game.CoreGui
    btnGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    btn.Name = "LButton"
    btn.Parent = btnGui
    btn.BackgroundColor3 = Color3.fromRGB(3,40,53)
    btn.BorderSizePixel = 0
    btn.Position = UDim2.new(0, 737, 0, 35)
    btn.Size = UDim2.new(0, 100, 0, 50)
    btn.Font = Enum.Font.GothamBlack
    btn.Text = "Lock"
    btn.TextColor3 = Color3.new(1,1,1)
    btn.TextSize = 18
    
    btn.MouseButton1Click:Connect(function()
        if lock then
            lock = false
        elseif not lock then
            lock = true
        end
        if not lock then
            UnLockNotif()
            VICTIM = nil
        end
        if lock then
            LockNotif()
        end
        startLock(user)
    end)
end)
tab2.newButton("Silent Lock", "Locks on the closest person.", function()
    local silentBtn = Instance.new("TextButton")
    silentBtn.Name = "SilentButton"
    silentBtn.Parent = game.CoreGui:FindFirstChild("ButtonHandler")
    silentBtn.BackgroundColor3 = Color3.fromRGB(3,40,53)
    silentBtn.BorderSizePixel = 0
    silentBtn.BackgroundTransparency = 0.1
    silentBtn.Position = UDim2.new(0, 630, 0, -15)
    silentBtn.Size = UDim2.new(0, 100, 0, 50)
    silentBtn.Font = Enum.Font.GothamBlack
    silentBtn.Text = "Silent Lock"
    silentBtn.TextColor3 = Color3.new(1,1,1)
    silentBtn.TextSize = 16
    silentBtn.TextTransparency = 0.132
    
    silentBtn.MouseButton1Click:Connect(function()
        if not silent then
            silent = true
        elseif silent then
            silent = false
        end
        if not silent then
            notify("Silent Unlocked", "No longer locking.", 0.7)
            silentVic = nil
        end
        if silent then
            notify("Target Selected", getClosest().Name, 0.7)
        end
        silentLock()
    end)
end)
tab2.newButton("Destroy Lock Buttons", "Destroys all buttons created by this script.", function()
    if game.CoreGui:FindFirstChild("ButtonHandler") then
        game.CoreGui:FindFirstChild("ButtonHandler"):Destroy()
    end
end)
tab2.newButton("Kick", "", function()
    local LP = game.Players.LocalPlayer
    if LP then
        LP:Kick("Did you get the last stomp?")
    end
end)

local colours = {
    "red",
    "orange",
    "yellow",
    "blue",
    "purple",
    "pink",
    "regular"
}
local colour = nil
tab3.newDropdown("Pick A Colour", "", colours, function(picked)
    colour = picked
end)
tab3.newButton("Apply Sky Colour", "(MUST RESET FOR IT TO WORK)", function()
    if colour == nil then
        colour = "regular"
    end
    game.Workspace[game.Players.LocalPlayer.Name]:SetAttribute("skycolor", colour)
    notify("Sky Colour Change", "Sky colour has been changed to: "..colour.."(MUST RESET)", 0.7)
end)